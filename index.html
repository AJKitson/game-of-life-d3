<!DOCTYPE html>
<html>
    <head>
        <script src="bower_components/d3/d3.min.js" charset="utf-8"></script>
        <script src="bower_components/underscore/underscore-min.js" charset="utf-8"></script>
    </head>
    <script type="text/javascript">
      //Set up D3
      var width = 1000;
      var height = 1000;

      d3.select('body')
        .append('svg')
        .attr('width', width)
        .attr('height', height)

      /*
        Store cell population as a graph, with live cells as the vertices and
        edges to indicate neighbors.

        Seed is an array of [x, y] tuples
      */
      var CellPopulation = function (seed) {
        var population = {};
        population._cells = {};
        population._neighbors = {};

        var cellToString = function (cell) {
          return cell[0] + '|' + cell[1];
        };
        population.getNeighbors = function (cell) {
          var neighbors = [];
          for (var y = -1; y <=1; y++) {
            for (var x = -1; x <=1; x++) {
              if (!(x === 0 && y === 0)) {
                neighbors.push([cell[0] + x, cell[1] + y]);
              }
            }
          }
          return neighbors;
        };

        // put x,y cells into the population and return population._cells
        population.addCellsToPopulation = function (cells) {
          //add cell tuples to population._cells object
          _.reduce(cells, function (population, cell) {
            population[cellToString(cell)] = cell;
            return population;
          }, population._cells);
          
          //update neighbors
          _.each(cells, function (cell) {

            var cellStr = cellToString(cell);
            var neighbors = population.getNeighbors(cell);
            population._neighbors[cellStr] = neighbors;
          });
        };

        population.cellInPopulation = function (cell) {
          return !!population._cells[cellToString(cell)];
        };

        population.removeCell = function (cell) {
          var cellStr = cellToString(cell);
          delete population._cells[cellStr];
          delete population._neighbors[cellStr];
        };

        population.liveCells = function () {
          var cells = [];
          for (var k in population._cells) {
            cells.push(population._cells[k]);
          }
          return cells;
        };
        return population;
      };




      var seed = []; //TODO -- get a good seed
      var world = CellPopulation(seed);

      var createNewGeneration = function (world) {

      };
      var updateWorld = function () {

      };
      d3.timer(createNewGeneration);



    </script>
    <body>

    </body>
</html>
